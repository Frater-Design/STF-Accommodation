<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SPECIAL TASK ACCOMMODATION | FRATER SUBMISSION</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #05070a;
      --panel: rgba(18, 24, 38, 0.75);
      --accent: #00d4ff;
      --text: #f0f4f8;
      --muted: #94a3b8;
      --border: rgba(255, 255, 255, 0.08);
      --radius: 20px;
      --glass: blur(15px);
      --viewport-bg: #ffffff;
      --header-off-white: #f8fafc;
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 0% 0%, #111827 0%, var(--bg) 60%);
      color: var(--text);
      padding: 15px; 
    }

    .container { max-width: 1500px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; }

    /* --- HEADER --- */
    .header {
      display: grid;
      grid-template-columns: 1fr; 
      background: var(--panel);
      backdrop-filter: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      gap: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    @media (min-width: 1024px) {
      .header { grid-template-columns: 1.2fr 1.6fr 1.2fr; align-items: center; padding: 30px; }
    }

    .info-group h3 { font-size: 10px; letter-spacing: 2px; color: var(--accent); margin: 0 0 6px; text-transform: uppercase; font-weight: 800; }
    .info-group p { font-size: 18px; font-weight: 800; margin: 0; color: #fff; line-height: 1.2; }

    .project-details { text-align: center; border-left: 1px solid var(--border); border-right: 1px solid var(--border); padding: 0 25px; }
    .project-details h1 { font-size: 22px; margin: 0; font-weight: 800; color: #fff; line-height: 1.3; text-transform: uppercase; }
    .project-details .code { font-size: 10px; color: var(--accent); margin-top: 10px; font-weight: 700; text-transform: uppercase; background: rgba(0, 212, 255, 0.15); display: inline-block; padding: 4px 12px; border-radius: 6px; }

    .brand-right { display: flex; flex-direction: column; align-items: flex-end; gap: 12px; }
    .frater-img { height: 50px; width: auto; border: none; }

    .btn-download {
      display: flex; align-items: center; gap: 6px; background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.3); color: var(--accent); padding: 8px 12px;
      border-radius: 6px; font-size: 10px; font-weight: 800; text-decoration: none; transition: all 0.2s ease;
    }

    /* --- MASTERPLAN VIEWPORT (UNCHANGED SECTION) --- */
    .viewport-box { 
      position: relative; width: 100%; height: 550px; background: var(--viewport-bg); 
      border-radius: var(--radius); border: 2px solid var(--border); 
      cursor: grab; display: flex; justify-content: center; align-items: center; overflow: hidden; 
      user-select: none;
      -webkit-user-select: none;
    }
    
    #mapWrapper { 
        position: relative; display: inline-block; transition: transform 0.1s ease-out; 
        will-change: transform; transform-origin: center center;
    }
    #layoutImg { display: block; max-width: 100%; max-height: 85vh; pointer-events: none; }

    .map-zone {
      position: absolute; cursor: pointer; background: rgba(0, 212, 255, 0); 
      border-radius: 4px; z-index: 100; transition: 0.3s;
    }
    .map-zone:hover { background: rgba(0, 212, 255, 0.15); border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(0, 212, 255, 0.4); }

    .hud-ui { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }

    /* --- NAVIGATION --- */
    .nav-section { display: flex; flex-direction: column; gap: 10px; margin: 10px 0; }
    .building-nav { display: flex; gap: 12px; justify-content: flex-start; }
    .btn-build {
        background: var(--panel); border: 1px solid var(--border); color: var(--muted);
        padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 12px; font-weight: 700; transition: 0.3s;
    }
    .btn-build.active { background: var(--accent); color: #000; border-color: #fff; }

    .zone-nav { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
    .btn-zone { background: var(--panel); border: 1px solid var(--border); color: #fff; padding: 12px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; cursor: pointer; text-align: center; transition: all 0.2s; }
    .btn-zone span { display: block; font-size: 8px; color: var(--accent); text-transform: uppercase; margin-bottom: 4px; }
    .btn-zone.active { background: var(--accent); color: #000; }
    .btn-zone.active span { color: #000; }

    /* --- CONTENT AREA (ALIGNED) --- */
    .content-layout { 
      display: grid; 
      grid-template-columns: 1fr; 
      gap: 20px; 
      scroll-margin: 120px; 
      align-items: stretch; /* Forces equal bottom alignment */
    }
    
    @media (min-width: 1024px) { 
      .content-layout { grid-template-columns: 1.2fr 0.8fr; } 
    }

    .card { 
      background: #ffffff !important; 
      border-radius: var(--radius); 
      border: 1px solid var(--border); 
      overflow: hidden; 
      display: flex; 
      flex-direction: column;
      height: 100%;
    }

    .card-header { 
      padding: 15px 20px; 
      background: var(--header-off-white); 
      border-bottom: 1px solid rgba(0,0,0,0.05); 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      height: 50px;
      flex-shrink: 0;
    }
    .card-header h4 { margin: 0; font-size: 11px; color: #1e293b; text-transform: uppercase; font-weight: 800; }
    
    .img-stage-main { 
      height: 600px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      background: #ffffff !important; 
      cursor: pointer; 
      position: relative; 
      overflow: hidden;
      user-select: none;
    }

    .img-side-wrapper { 
      display: flex; 
      flex-direction: column; 
      gap: 20px; 
      height: 100%;
    }

    .side-card { flex: 1; }

    .img-stage-side { 
      flex: 1; /* Automatically matches Room Viewport bottom line */
      display: flex; 
      align-items: center; 
      justify-content: center; 
      background: #ffffff !important; 
      cursor: pointer; 
      overflow: hidden;
      user-select: none;
      position: relative;
    }

    /* Technical Data Sheet Button */
    .btn-tech-spec {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: #111827;
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 8px 15px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;
      cursor: pointer;
      z-index: 10;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    .btn-tech-spec:hover {
      background: var(--accent);
      color: #000;
    }

    .img-stage-main img, .img-stage-side img { 
      max-width: 100%; 
      max-height: 100%; 
      width: auto; 
      height: auto; 
      object-fit: contain; 
      padding: 15px; 
      pointer-events: none;
    }

    .nav-arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(0,0,0,0.1); color: #333;
      width: 45px; height: 45px; border-radius: 50%; cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center; font-size: 20px; transition: 0.2s;
      user-select: none;
    }
    .nav-arrow:hover { background: var(--accent); color: #000; border-color: var(--accent); }
    .arrow-left { left: 15px; }
    .arrow-right { right: 15px; }

    /* --- POPUP LIGHTBOX --- */
    #popOverlay { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(255,255,255,0.98); backdrop-filter: blur(15px); 
      display: none; justify-content: center; align-items: center; z-index: 9999; 
    }
    #popOverlay.active { display: flex; }
    .pop-content { position: relative; width: 95%; height: 95%; display: flex; justify-content: center; align-items: center; }
    .pop-content img { max-width: 100%; max-height: 100%; object-fit: contain; pointer-events: none; }
    .pop-close { position: absolute; top: 20px; right: 20px; color: #333; background: rgba(0,0,0,0.05); border: none; font-size: 24px; cursor: pointer; border-radius: 50%; width: 50px; height: 50px; z-index: 10000; }

    .pop-arrow { background: rgba(0, 0, 0, 0.1); border: 1px solid #333; color: #333; }
    .pop-arrow:hover { background: #000; color: #fff; }

    .disclaimer-container { margin-top: 30px; padding: 20px; border-top: 1px solid var(--border); }
    .disclaimer-text { 
      font-size: 11px; color: var(--muted); line-height: 1.6; text-align: left; 
      max-width: 1200px; margin: 0; display: -webkit-box; -webkit-line-clamp: 2; 
      -webkit-box-orient: vertical; overflow: hidden;
    }
  </style>
</head>
<body>

<div class="container">
  <header class="header">
    <div class="brand-stack">
      <div class="info-group"><h3>Client</h3><p>Abu Dhabi Police</p></div>
      <div class="info-group" style="margin-top: 15px;"><h3>Employer</h3><p>Aldar Projects</p></div>
    </div>
    <div class="project-details">
      <h1>SPECIAL TASK ACCOMMODATION</h1>
      <div class="code">Lighting Design Proposal</div>
    </div>
    <div class="brand-right">
      <a href="https://www.fraterlighting.com/"><img src="Frater.png" alt="FRATER" class="frater-img"></a>
      <div style="display: flex; gap: 8px; margin-top: 8px;">
        <a href="Summary.pdf" target="_blank" class="btn-download">SUMMARY</a>
        <a href="Luxreport.pdf" target="_blank" class="btn-download">LUX REPORT</a>
        <a href="Layout.pdf" target="_blank" class="btn-download">LAYOUT</a>
      </div>
    </div>
  </header>

  <div class="nav-section">
    <nav class="building-nav">
        <button class="btn-build active" onclick="switchBuilding(1)">B02 - NCO ACCOMMODATION</button>
        <button class="btn-build" onclick="switchBuilding(2)">B03 - NCO AMENITIES</button>
    </nav>
    
    <section class="viewport-box" id="vpContainer">
      <div id="mapWrapper">
          <img src="LayoutB02.png" id="layoutImg">
          <div id="b1_zones">
            <div class="map-zone" style="top:35.5%; left: 23.6%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 30.3%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 37.0%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 43.7%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 50.4%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 57.1%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:35.5%; left: 63.8%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 23.6%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 30.3%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 37.0%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 43.7%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 50.4%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:59.5%; left: 57.1%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>
            <div class="map-zone" style="top:60.5%; left: 63.8%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(1)"></div>

            <div class="map-zone" style="top:43.6%; left: 10.7%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(2)"></div>
            <div class="map-zone" style="top:48.6%; left: 39.3%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(3)"></div>
            <div class="map-zone" style="top:59.8%; left: 11.9%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(4)"></div>
            <div class="map-zone" style="top:48.1%; left: 90.0%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(5)"></div>
            <div class="map-zone" style="top:39.2%; left: 3.4%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(6)"></div>
            <div class="map-zone" style="top:59.5%; left: 79.0%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(7)"></div>
            <div class="map-zone" style="top:34.2%; left: 79.9%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(8)"></div>
            <div class="map-zone" style="top:35.3%; left: 70.7%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(9)"></div>
            <div class="map-zone" style="top:33.5%; left: 17.4%; width: 5.0%; height: 3.0%;" onclick="triggerRoom(10)"></div>
          </div>
          <div id="b2_zones" style="display:none;">
            <div class="map-zone" style="top: 40%; left: 20%; width: 12%; height: 10%;" onclick="triggerRoom(1)"></div>
          </div>
      </div>
    </section>

    <div class="hud-ui">
        <span style="font-size: 9px; color: var(--muted); text-transform: uppercase;">Pinch/Scroll to Zoom | Drag to Pan | Click Layout to Jump</span>
        <button onclick="resetView()" style="background: rgba(0,212,255,0.1); border: 1px solid var(--accent); color: var(--accent); padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 10px; font-weight: 700;">FIT TO VIEW</button>
    </div>
  </div>

  <nav class="zone-nav" id="room_buttons"></nav>

  <main class="content-layout" id="roomDetailsArea">
    <div class="card">
      <div class="card-header">
        <h4 id="room_title">Room 01</h4>
        <span id="img_counter" style="font-size: 10px; color: #64748b; font-weight: 700;">IMAGE 01 / 03</span>
      </div>
      <div class="img-stage-main" onclick="openPop('main')">
        <button class="nav-arrow arrow-left" onclick="event.stopPropagation(); changeImage(-1)">&#10094;</button>
        <img id="main_display" src="B01RM01IM01.png">
        <button class="nav-arrow arrow-right" onclick="event.stopPropagation(); changeImage(1)">&#10095;</button>
      </div>
    </div>

    <div class="img-side-wrapper">
      <div class="card side-card" onclick="openPop('calc')">
        <div class="card-header"><h4>Calculations Result</h4></div>
        <div class="img-stage-side"><img id="calc_display" src="B1RS01.png"></div>
      </div>
      <div class="card side-card">
        <div class="card-header"><h4>Proposed Fixture</h4></div>
        <div class="img-stage-side">
          <img id="fixture_display" src="B1FX01.png" onclick="openPop('fix')">
          <a id="tech_sheet_btn" href="https://www.google.com" target="_blank" class="btn-tech-spec">Technical Data Sheet</a>
        </div>
      </div>
    </div>
  </main>

  <div class="disclaimer-container">
    <div class="disclaimer-text">
      <strong>Notice regarding Project Representation:</strong> Frater Lighting Design Hub reserves the professional right to feature this design proposal and presentation 
      within our digital archive and project design hub as a formal showcase of our architectural standards and technical capabilities. We remain committed to the 
      highest standards of professional etiquette while presenting our lighting solutions to the public.
    </div>
  </div>
</div>

<div id="popOverlay">
  <div class="pop-content">
    <button class="pop-close" onclick="closePop()">âœ•</button>
    <button id="pop_arrow_left" class="nav-arrow arrow-left pop-arrow" onclick="changeImage(-1)">&#10094;</button>
    <img id="popImg" src="">
    <button id="pop_arrow_right" class="nav-arrow arrow-right pop-arrow" onclick="changeImage(1)">&#10095;</button>
  </div>
</div>

<script>
  if (history.scrollRestoration) history.scrollRestoration = 'manual';
  window.scrollTo(0, 0);

const buildings = {
  1: { 
    id: "B01", prefix: "B1", suffix: "B02", rooms: 10,
    names: ["Typical Bedroom", "Entrance/ Reception", "Main Corridor", "Toilet Area 01", "Toilet Area 02", "Service Area 01", "Service Area 02", "Service Area 03", "Security Control", "Supervisor Office"],
    // REPLACE THIS: Replace the .fill() with your specific B02 links
    specLinks: [
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_DL_Gemini_05_Dec25.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_Downlights_DLS1_24-5db01992.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_Downlights_DLS1_24-5db01992.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_DL_Gemini_05_Dec25.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_DL_Gemini_05_Dec25.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_WP_Caliber_24.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_Downlights_DLS1_24-5db01992.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_WP_Caliber_24.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_Panel_BP10_24_R1.pdf",
      "https://irp.cdn-website.com/2e271d71/files/uploaded/Frater_Panel_BP10_24_R1.pdf"
    ]
  },
  2: { 
    id: "B02", prefix: "B2", suffix: "B03", rooms: 10,
    // REPLACE THIS: Replace the .fill() with your specific B03 links
    specLinks: [
      "https://b03-link-01.com",
      "https://b03-link-02.com",
      "https://b03-link-03.com",
      "https://b03-link-04.com",
      "https://b03-link-05.com",
      "https://b03-link-06.com",
      "https://b03-link-07.com",
      "https://b03-link-08.com",
      "https://b03-link-09.com",
      "https://b03-link-10.com"
    ]
  }
};

  let currentBuild = 1;
  let currentRoom = 1;
  let currentImgIdx = 1;
  let isMainPopup = false;
  let maxImagesAvailable = 3; 

  const vp = document.getElementById('vpContainer'), wrapper = document.getElementById('mapWrapper');
  let scale = 1.15, panning = false, px = 0, py = 0, start = { x: 0, y: 0 };

  function setTransform() { if (scale < 1.15) scale = 1.15; wrapper.style.transform = `translate(${px}px, ${py}px) scale(${scale})`; }
  function resetView() { scale = 1.15; px = 0; py = 0; setTransform(); }

  vp.onmousedown = (e) => { if (e.target.classList.contains('map-zone')) return; e.preventDefault(); start = { x: e.clientX - px, y: e.clientY - py }; panning = true; }
  window.addEventListener('mouseup', () => { panning = false; });
  vp.onmousemove = (e) => { if (panning) { px = (e.clientX - start.x); py = (e.clientY - start.y); setTransform(); }}
  vp.onwheel = (e) => { e.preventDefault(); scale = Math.min(Math.max(1.15, scale + (e.deltaY < 0 ? 0.1 : -0.1)), 5); setTransform(); }

  function switchBuilding(id) {
    currentBuild = id; currentRoom = 1; currentImgIdx = 1;
    document.querySelectorAll('.btn-build').forEach((btn, idx) => btn.classList.toggle('active', idx + 1 === id));
    document.getElementById('b1_zones').style.display = id === 1 ? 'block' : 'none';
    document.getElementById('b2_zones').style.display = id === 2 ? 'block' : 'none';
    document.getElementById('layoutImg').src = `Layout${buildings[id].suffix}.png`;
    renderRoomButtons(); updateRoomUI(false); resetView();
  }

  function triggerRoom(idx) { 
    const btn = document.getElementById(`btn-room-${idx}`);
    if(btn) btn.click(); 
  }

  function renderRoomButtons() {
    const container = document.getElementById('room_buttons');
    const buildData = buildings[currentBuild];
    container.innerHTML = '';
    for (let i = 1; i <= buildData.rooms; i++) {
      const btn = document.createElement('button');
      btn.id = `btn-room-${i}`;
      btn.className = `btn-zone ${i === currentRoom ? 'active' : ''}`;
      const label = buildData.names ? buildData.names[i-1] : `Room ${String(i).padStart(2, '0')}`;
      btn.innerHTML = `<span>Room ${String(i).padStart(2, '0')}</span> ${label}`;
      btn.onclick = () => { currentRoom = i; currentImgIdx = 1; updateRoomUI(true); };
      container.appendChild(btn);
    }
  }

  function changeImage(n) { 
    currentImgIdx += n; 
    if (currentImgIdx > maxImagesAvailable) currentImgIdx = 1; 
    if (currentImgIdx < 1) currentImgIdx = maxImagesAvailable; 
    updateRoomUI(false); 
  }

  function updateRoomUI(shouldScroll) {
    const bData = buildings[currentBuild];
    const rId = String(currentRoom).padStart(2, '0');
    
    // Feature Check: Loop logic for available images
    const testImg = new Image();
    testImg.src = `${bData.id}RM${rId}IM03.png`;
    testImg.onload = () => { maxImagesAvailable = 3; finishUpdate(); };
    testImg.onerror = () => { maxImagesAvailable = 2; if(currentImgIdx > 2) currentImgIdx = 1; finishUpdate(); };

    function finishUpdate() {
        const iId = String(currentImgIdx).padStart(2, '0');
        document.querySelectorAll('.btn-zone').forEach(b => b.classList.toggle('active', b.id === `btn-room-${currentRoom}`));
        const roomLabel = bData.names ? bData.names[currentRoom-1] : `Room ${rId}`;
        document.getElementById('room_title').innerText = `Room ${rId}: ${roomLabel}`;
        document.getElementById('img_counter').innerText = `IMAGE ${iId} / 0${maxImagesAvailable}`;
        
        const mainImgPath = `${bData.id}RM${rId}IM${iId}.png`;
        document.getElementById('main_display').src = mainImgPath;
        
        if (document.getElementById('popOverlay').classList.contains('active') && isMainPopup) {
            document.getElementById('popImg').src = mainImgPath;
        }

        document.getElementById('calc_display').src = `${bData.prefix}RS${rId}.png`;
        document.getElementById('fixture_display').src = `${bData.prefix}FX${rId}.png`;
        
        // Update Technical Spec Sheet link based on Building
        const techBtn = document.getElementById('tech_sheet_btn');
        if (bData.specLinks) {
          techBtn.href = bData.specLinks[currentRoom - 1];
          techBtn.style.display = 'inline-block';
        } else {
          techBtn.style.display = 'none';
        }

        if (shouldScroll) document.getElementById('roomDetailsArea').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  function openPop(type) {
    const bData = buildings[currentBuild];
    const rId = String(currentRoom).padStart(2, '0');
    const popImg = document.getElementById('popImg');
    const popArrowL = document.getElementById('pop_arrow_left');
    const popArrowR = document.getElementById('pop_arrow_right');

    if (type === 'main') {
      isMainPopup = true;
      popImg.src = `${bData.id}RM${rId}IM${String(currentImgIdx).padStart(2, '0')}.png`;
      popArrowL.style.display = 'flex'; popArrowR.style.display = 'flex';
    } else {
      isMainPopup = false;
      popImg.src = `${bData.prefix}${type === 'calc' ? 'RS' : 'FX'}${rId}.png`;
      popArrowL.style.display = 'none'; popArrowR.style.display = 'none';
    }
    document.getElementById('popOverlay').classList.add('active');
  }
  function closePop() { document.getElementById('popOverlay').classList.remove('active'); }
  
  renderRoomButtons(); 
  updateRoomUI(false); 
  resetView(); 
</script>
</body>
</html>